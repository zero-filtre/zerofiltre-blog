<main class="text-skin-art min-h-screen">
    <div *ngIf="isLoading" class="flex items-center justify-center h-[88vh]">
        <svg class="w-40 animate-spin text-primary-500" xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink" width="200px" height="200px" viewBox="0 0 100 100"
            preserveAspectRatio="xMidYMid">
            <circle cx="50" cy="50" fill="none" stroke="currentColor" stroke-width="4" r="35"
                stroke-dasharray="164.93361431346415 56.97787143782138" transform="matrix(1,0,0,1,0,0)"
                style="animation-play-state:paused"></circle>
        </svg>
    </div>

    <div *ngIf="course$|async as course" class="content flex flex-col">

        <div class="page-title site-container py-8 lg:pt-14 text-center space-y-5 lg:max-w-7xl mx-auto">
            <h1>{{course?.title}}</h1>
            <h2>{{course?.subTitle}}</h2>
        </div>

        <ng-container *ngFor="let section of course?.sections; let i = index">
            <section class="section py-6 lg:py-12 site-container flex flex-col lg:flex-row justify-between">
                <div
                    class="why-text order-2 lg:basis-1/2 xl:basis-2/3 text-center lg:text-left flex flex-col lg:mx-0 mt-8 sm:mt-9 lg:mt-0 lg:px-2">
                    <h3>{{section.title}}</h3>

                    <app-markdown-preview [data]="section?.content"></app-markdown-preview>
                </div>

                <div class="why-image m-auto order-1 lg:basis-1/2 xl:basis-1/3">
                    <app-image [classes]="'m-auto object-contain w-auto sm:max-w-[50%] lg:max-w-full'"
                        [sourceUrl]="section?.image" [alt]="section?.title">
                    </app-image>
                </div>
            </section>
        </ng-container>

        <div class="reactions py-10 border bg-secondary grid place-items-center border-skin-border">
            <!-- *ngIf="!loading && (isPublished$ | async)" -->
            <div class="reactions-container mt-5 flex flex-wrap justify-center lg:justify-start gap-10">
                <button *ngFor="let reaction of typesOfReactions" (click)="addReaction(reaction.action)"
                    class="group flex items-center justify-center transition-all duration-300"
                    attr.aria-label="{{reaction.action}} button">

                    <div
                        class="reaction-wrapper flex flex-col gap-5 group-hover:-translate-y-2 transition-all ease-in duration-200">
                        <ng-container *ngIf="reaction.action === 'clap'">
                            <div class="group-hover:scale-[4] scale-[3.5] transition-all ease-in duration-200">
                                {{reaction.emoji}}
                            </div>
                            <div class="text-lg font-semibold text-skin-link">
                                {{clapReactions$ | async}}
                            </div>
                        </ng-container>
                        <ng-container *ngIf="reaction.action === 'fire'">
                            <div class="group-hover:scale-[4] scale-[3.5] transition-all ease-in duration-200">
                                {{reaction.emoji}}
                            </div>
                            <div class="text-lg font-semibold text-skin-link">
                                {{fireReactions$ | async}}
                            </div>
                        </ng-container>
                        <ng-container *ngIf="reaction.action === 'love'">
                            <div class="group-hover:scale-[4] scale-[3.5] transition-all ease-in duration-200">
                                {{reaction.emoji}}
                            </div>
                            <div class="text-lg font-semibold text-skin-link">
                                {{loveReactions$ | async}}
                            </div>
                        </ng-container>
                        <ng-container *ngIf="reaction.action === 'like'">
                            <div class="group-hover:scale-[4] scale-[3.5] transition-all ease-in duration-200">
                                {{reaction.emoji}}
                            </div>
                            <div class="text-lg font-semibold text-skin-link">
                                {{likeReactions$ | async}}
                            </div>
                        </ng-container>
                    </div>
                </button>
            </div>

            <ng-container *ngIf="loading" class="articleReactionButtonsSkeletonLoader">
                <ngx-skeleton-loader class="space-x-2" count="4" appearance="line"
                    [theme]="{ 
                        'border-radius': '5px',
                            height: '20px',
                            width: '20px'
                        }">
                </ngx-skeleton-loader>
            </ng-container>
        </div>
        

        <section class="practical-video-section site-container section py-6 lg:py-12">

            <app-youtube-video-player [videoId]="currentVideoId" [width]="800" [height]="450"></app-youtube-video-player>

        </section>
        
        <section class="section curriculum py-6 lg:py-12">
            <app-curriculum [chapters]="chapters$|async" [lessons]="lessons$|async" [course]="course"
                [canAccessCourse]="canAccessCourse" [isSubscriber]="isSubscriber"></app-curriculum>
        </section>

        <button *ngIf="!(courseSubscription$|async)" (click)="subscribeToCourse()"
            class="my-10 w-fit mx-auto flex items-center justify-center gap-2 px-4 py-2.5 rounded-md shadow-sm bg-primary-500 text-white font-normal hover:bg-primary-700 transition-all duration-300">
            <span class="text-center">Acheter ce cours</span>

            <span class="mt-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden md:block" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                </svg>
            </span>
        </button>

    </div>
</main>