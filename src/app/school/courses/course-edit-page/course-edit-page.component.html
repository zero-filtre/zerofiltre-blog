<main class="site-container relative py-10 lg:py-14 min-h-screen">
    <form *ngIf="course$ |async " [formGroup]="form" class="lg:max-w-4xl mx-auto">

        <div class="mb-8">
            <input type="text" placeholder="Entrez le titre du cours" (keyup)="typeInTitle(getValue($event))" id="title"
                required minlength="4" formControlName="title"
                class="input transition-none shadow-none bg-skin-bg focus:outline-none focus:ring-0 border-0 border-b-2 rounded-none w-full" />

            <div *ngIf="title?.invalid && title?.dirty" class="">
                <div *ngIf="title?.errors?.['required']" class="mt-2 text-xs sm:text-sm text-error italic">
                    {{ 'articleEntryEdit.missingTitle' | translate }}
                </div>
                <div *ngIf="title?.errors?.['minlength']" class="mt-2 text-xs sm:text-sm text-error italic">
                    {{ 'articleEntryEdit.invalidTitleLenght' | translate }}
                </div>
            </div>
        </div>

        <div class="mb-5">
            <textarea type="text" placeholder="Entrez la description" (keyup)="typeInSummary(getValue($event))"
                id="summary" formControlName="summary" required minlength="20" maxlength="250"
                class="textarea h-24 transition-none bg-skin-bg focus:outline-none focus:ring-0  w-full"></textarea>
        </div>

        <div class="mb-8">
            <div class="course-video-preview-wrapper relative mt-10">
                <div *ngIf="!thumbnail?.value" class="label-image-preview relative aspect-w-4 aspect-h-2">
                    <label *ngIf="!uploading" for="file" (click)="fileUpload.click()"
                        class="preview-label group flex items-center justify-center rounded-md cursor-pointer">

                        <div class="label absolute -top-3 left-5 text-base font-semibold leading-5 text-skin-base">
                            Thumbnail
                        </div>

                        <div class="text-center">
                            <svg class="mx-auto h-10 w-10 text-skin-muted" stroke="currentColor" fill="none"
                                viewBox="0 0 48 48">
                                <path
                                    d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                            <p class="mt-1 text-xs text-skin-base leading-6">
                                <span
                                    class="font-semibold text-primary-500 focus:outline-none focus:underline transition duration-150 ease-in-out">
                                    Upload a file
                                </span>
                            </p>
                            <p class="mt-1 text-xs text-skin-muted">
                                PNG, JPG, GIF up to 5MB
                            </p>

                            <input class="sr-only" type="file" id="fileUpload" name="fileUpload" #fileUpload
                                (change)="onFileSelected($event)" accept="image/*">
                        </div>
                    </label>

                    <div *ngIf="uploading" class="flex items-center justify-center shadow-lg rounded-lg border">
                        <svg class="w-10 h-10 animate-spin text-primary-500" xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink" width="200px" height="200px"
                            viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">
                            <circle cx="50" cy="50" fill="none" stroke="currentColor" stroke-width="8" r="35"
                                stroke-dasharray="164.93361431346415 56.97787143782138" transform="matrix(1,0,0,1,0,0)"
                                style="animation-play-state:paused"></circle>
                        </svg>
                    </div>
                </div>

                <div *ngIf="thumbnail?.value"
                    class="image-wrapper shadow-lg overflow-hidden rounded-lg aspect-w-4 aspect-h-2">
                    <app-image [classes]="'object-cover'" [sourceUrl]="thumbnail?.value!" [alt]="title.value">
                    </app-image>
                </div>

                <div *ngIf="thumbnail?.value"
                    class="cover-close-btn absolute top-0 right-0 z-10 flex justify-center w-5 h-5 mt-2 mr-2 text-sm leading-tight text-white bg-gray-700 rounded-full opacity-80 cursor-pointer hover:opacity-100"
                    (click)="removeCoverImage()">x
                </div>
            </div>
        </div>

        <div class="flex justify-end mb-5">
            <ng-container *ngIf="form.invalid; else validBtn">
                <button [disabled]="form.invalid || isLoading" aria-labelledby="button to update or submit a course"
                    class="group font-semibold relative w-full flex justify-center py-2 px-4 border border-transparent text-sm rounded-full text-white bg-primary-300 bg-opacity-20">
                    <span>Enregistrer</span>
                </button>
            </ng-container>

            <ng-template #validBtn>
                <button type="submit" aria-labelledby="button to publish or submit an article" (click)="updateCourse()"
                    [disabled]="isSaving || isLoading" [ngClass]="{'opacity-50': isSaving || isLoading }"
                    class="group font-semibold relative w-full flex justify-center gap-2 py-2 px-4 border border-transparent text-sm shadow-lg rounded-full text-white bg-primary-300 hover:bg-primary-500 focus:outline-none transition-all duration-200">
                    <span *ngIf="!isSaving">Enregistrer</span>
                    <svg *ngIf="isSaving" class="w-5 h-5 animate-spin" xmlns="http://www.w3.org/2000/svg"
                        xmlns:xlink="http://www.w3.org/1999/xlink" width="200px" height="200px" viewBox="0 0 100 100"
                        preserveAspectRatio="xMidYMid">
                        <circle cx="50" cy="50" fill="none" stroke="#fff" stroke-width="10" r="35"
                            stroke-dasharray="164.93361431346415 56.97787143782138" transform="matrix(1,0,0,1,0,0)"
                            style="animation-play-state:paused"></circle>
                    </svg>
                </button>
            </ng-template>
        </div>
    </form>
</main>